using Microsoft.AspNetCore.Authorization;
using Microsoft.AspNetCore.Mvc;
using UtilityManagmentApi.Services.Interfaces;

namespace UtilityManagmentApi.Controllers;

[ApiController]
[Route("api/[controller]")]
[Authorize]
public class ReportsController : ControllerBase
{
    private readonly IReportService _reportService;

  public ReportsController(IReportService reportService)
    {
      _reportService = reportService;
    }

    [HttpGet("dashboard")]
    [Authorize(Roles = "Admin,BillingOfficer,AccountOfficer")]
    public async Task<IActionResult> GetDashboardSummary()
    {
        var result = await _reportService.GetDashboardSummaryAsync();
        return Ok(result);
    }

    [HttpGet("revenue/monthly")]
    [Authorize(Roles = "Admin,AccountOfficer")]
    public async Task<IActionResult> GetMonthlyRevenueReport([FromQuery] int month, [FromQuery] int year)
    {
        var result = await _reportService.GetMonthlyRevenueReportAsync(month, year);
return Ok(result);
    }

    [HttpGet("revenue/yearly")]
    [Authorize(Roles = "Admin,AccountOfficer")]
    public async Task<IActionResult> GetYearlyRevenueReport([FromQuery] int year)
    {
        var result = await _reportService.GetYearlyRevenueReportAsync(year);
        return Ok(result);
    }

    [HttpGet("outstanding-dues")]
    [Authorize(Roles = "Admin,AccountOfficer")]
    public async Task<IActionResult> GetOutstandingDuesReport()
    {
        var result = await _reportService.GetOutstandingDuesReportAsync();
        return Ok(result);
    }

    [HttpGet("consumption")]
    [Authorize(Roles = "Admin,BillingOfficer")]
    public async Task<IActionResult> GetConsumptionReport([FromQuery] int month, [FromQuery] int year)
    {
var result = await _reportService.GetConsumptionReportAsync(month, year);
        return Ok(result);
    }

    [HttpGet("consumer-billing/{consumerId}")]
    [Authorize(Roles = "Admin,AccountOfficer")]
    public async Task<IActionResult> GetConsumerBillingSummary(int consumerId)
    {
        var result = await _reportService.GetConsumerBillingSummaryAsync(consumerId);
        if (!result.Success)
  {
   return NotFound(result);
        }
        return Ok(result);
    }

    [HttpGet("collection")]
    [Authorize(Roles = "Admin,AccountOfficer")]
    public async Task<IActionResult> GetCollectionReport([FromQuery] DateTime fromDate, [FromQuery] DateTime toDate)
    {
var result = await _reportService.GetCollectionReportAsync(fromDate, toDate);
        return Ok(result);
    }
}
