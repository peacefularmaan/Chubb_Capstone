using System.ComponentModel.DataAnnotations;
using UtilityManagmentApi.DTOs.Auth;

namespace TestProject.DTOs;

public class AuthDtosValidationTests
{
    private List<ValidationResult> ValidateModel(object model)
    {
        var validationResults = new List<ValidationResult>();
        var validationContext = new ValidationContext(model, null, null);
        Validator.TryValidateObject(model, validationContext, validationResults, true);
        return validationResults;
    }

    #region LoginRequestDto Validation Tests

    [Fact]
    public void LoginRequestDto_WithValidData_PassesValidation()
    {
        // Arrange
        var dto = new LoginRequestDto
        {
            Email = "user@test.com",
            Password = "Password123!"
        };

        // Act
        var validationResults = ValidateModel(dto);

        // Assert
        Assert.Empty(validationResults);
    }

    [Fact]
    public void LoginRequestDto_WithInvalidEmail_FailsValidation()
    {
        // Arrange
        var dto = new LoginRequestDto
        {
            Email = "invalid-email",
            Password = "Password123!"
        };

        // Act
        var validationResults = ValidateModel(dto);

        // Assert
        Assert.NotEmpty(validationResults);
        Assert.Contains(validationResults, v => v.MemberNames.Contains(nameof(LoginRequestDto.Email)));
    }

    [Fact]
    public void LoginRequestDto_WithEmptyEmail_FailsValidation()
    {
        // Arrange
        var dto = new LoginRequestDto
        {
            Email = "",
            Password = "Password123!"
        };

        // Act
        var validationResults = ValidateModel(dto);

        // Assert
        Assert.NotEmpty(validationResults);
    }

    [Fact]
    public void LoginRequestDto_WithEmptyPassword_FailsValidation()
    {
        // Arrange
        var dto = new LoginRequestDto
        {
            Email = "user@test.com",
            Password = ""
        };

        // Act
        var validationResults = ValidateModel(dto);

        // Assert
        Assert.NotEmpty(validationResults);
    }

    #endregion

    #region ConsumerRegisterDto Validation Tests

    [Fact]
    public void ConsumerRegisterDto_WithValidData_PassesValidation()
    {
        // Arrange
        var dto = new ConsumerRegisterDto
        {
            FirstName = "John",
            LastName = "Doe",
            Email = "john.doe@test.com",
            Password = "Password123!",
            Phone = "1234567890",
            Address = "123 Main St",
            City = "Test City",
            State = "Test State",
            PostalCode = "12345"
        };

        // Act
        var validationResults = ValidateModel(dto);

        // Assert
        Assert.Empty(validationResults);
    }

    [Fact]
    public void ConsumerRegisterDto_WithEmptyFirstName_FailsValidation()
    {
        // Arrange
        var dto = new ConsumerRegisterDto
        {
            FirstName = "",
            LastName = "Doe",
            Email = "john.doe@test.com",
            Password = "Password123!",
            Address = "123 Main St"
        };

        // Act
        var validationResults = ValidateModel(dto);

        // Assert
        Assert.NotEmpty(validationResults);
        Assert.Contains(validationResults, v => v.MemberNames.Contains(nameof(ConsumerRegisterDto.FirstName)));
    }

    [Fact]
    public void ConsumerRegisterDto_WithEmptyLastName_FailsValidation()
    {
        // Arrange
        var dto = new ConsumerRegisterDto
        {
            FirstName = "John",
            LastName = "",
            Email = "john.doe@test.com",
            Password = "Password123!",
            Address = "123 Main St"
        };

        // Act
        var validationResults = ValidateModel(dto);

        // Assert
        Assert.NotEmpty(validationResults);
        Assert.Contains(validationResults, v => v.MemberNames.Contains(nameof(ConsumerRegisterDto.LastName)));
    }

    [Fact]
    public void ConsumerRegisterDto_WithInvalidEmail_FailsValidation()
    {
        // Arrange
        var dto = new ConsumerRegisterDto
        {
            FirstName = "John",
            LastName = "Doe",
            Email = "invalid-email",
            Password = "Password123!",
            Address = "123 Main St"
        };

        // Act
        var validationResults = ValidateModel(dto);

        // Assert
        Assert.NotEmpty(validationResults);
        Assert.Contains(validationResults, v => v.MemberNames.Contains(nameof(ConsumerRegisterDto.Email)));
    }

    [Fact]
    public void ConsumerRegisterDto_WithShortPassword_FailsValidation()
    {
        // Arrange
        var dto = new ConsumerRegisterDto
        {
            FirstName = "John",
            LastName = "Doe",
            Email = "john.doe@test.com",
            Password = "12345", // Less than 6 characters
            Address = "123 Main St"
        };

        // Act
        var validationResults = ValidateModel(dto);

        // Assert
        Assert.NotEmpty(validationResults);
        Assert.Contains(validationResults, v => v.MemberNames.Contains(nameof(ConsumerRegisterDto.Password)));
    }

    [Fact]
    public void ConsumerRegisterDto_WithEmptyAddress_FailsValidation()
    {
        // Arrange
        var dto = new ConsumerRegisterDto
        {
            FirstName = "John",
            LastName = "Doe",
            Email = "john.doe@test.com",
            Password = "Password123!",
            Address = ""
        };

        // Act
        var validationResults = ValidateModel(dto);

        // Assert
        Assert.NotEmpty(validationResults);
        Assert.Contains(validationResults, v => v.MemberNames.Contains(nameof(ConsumerRegisterDto.Address)));
    }

    [Fact]
    public void ConsumerRegisterDto_WithFirstNameTooLong_FailsValidation()
    {
        // Arrange
        var dto = new ConsumerRegisterDto
        {
            FirstName = new string('A', 101), // Exceeds 100 char limit
            LastName = "Doe",
            Email = "john.doe@test.com",
            Password = "Password123!",
            Address = "123 Main St"
        };

        // Act
        var validationResults = ValidateModel(dto);

        // Assert
        Assert.NotEmpty(validationResults);
        Assert.Contains(validationResults, v => v.MemberNames.Contains(nameof(ConsumerRegisterDto.FirstName)));
    }

    [Fact]
    public void ConsumerRegisterDto_WithEmailTooLong_FailsValidation()
    {
        // Arrange
        var longEmail = new string('a', 250) + "@test.com"; // Exceeds 256 char limit
        var dto = new ConsumerRegisterDto
        {
            FirstName = "John",
            LastName = "Doe",
            Email = longEmail,
            Password = "Password123!",
            Address = "123 Main St"
        };

        // Act
        var validationResults = ValidateModel(dto);

        // Assert
        Assert.NotEmpty(validationResults);
        Assert.Contains(validationResults, v => v.MemberNames.Contains(nameof(ConsumerRegisterDto.Email)));
    }

    [Fact]
    public void ConsumerRegisterDto_WithOptionalFieldsNull_PassesValidation()
    {
        // Arrange
        var dto = new ConsumerRegisterDto
        {
            FirstName = "John",
            LastName = "Doe",
            Email = "john.doe@test.com",
            Password = "Password123!",
            Phone = null,
            Address = "123 Main St",
            City = "Test City",
            State = "Test State",
            PostalCode = "12345"
        };

        // Act
        var validationResults = ValidateModel(dto);

        // Assert
        Assert.Empty(validationResults);
    }

    #endregion

    #region RegisterRequestDto Validation Tests

    [Fact]
    public void RegisterRequestDto_WithValidData_PassesValidation()
    {
        // Arrange
        var dto = new RegisterRequestDto
        {
            FirstName = "Admin",
            LastName = "User",
            Email = "admin@test.com",
            Password = "Password123!",
            Role = "Admin"
        };

        // Act
        var validationResults = ValidateModel(dto);

        // Assert
        Assert.Empty(validationResults);
    }

    [Fact]
    public void RegisterRequestDto_WithEmptyRole_FailsValidation()
    {
        // Arrange
        var dto = new RegisterRequestDto
        {
            FirstName = "Admin",
            LastName = "User",
            Email = "admin@test.com",
            Password = "Password123!",
            Role = ""
        };

        // Act
        var validationResults = ValidateModel(dto);

        // Assert
        Assert.NotEmpty(validationResults);
        Assert.Contains(validationResults, v => v.MemberNames.Contains(nameof(RegisterRequestDto.Role)));
    }

    [Theory]
    [InlineData("Admin")]
    [InlineData("BillingOfficer")]
    [InlineData("AccountOfficer")]
    public void RegisterRequestDto_WithValidRoles_PassesValidation(string role)
    {
        // Arrange
        var dto = new RegisterRequestDto
        {
            FirstName = "Test",
            LastName = "User",
            Email = "test@test.com",
            Password = "Password123!",
            Role = role
        };

        // Act
        var validationResults = ValidateModel(dto);

        // Assert
        Assert.Empty(validationResults);
    }

    #endregion

    #region UpdateUserDto Validation Tests

    [Fact]
    public void UpdateUserDto_WithValidData_PassesValidation()
    {
        // Arrange
        var dto = new UpdateUserDto
        {
            FirstName = "Updated",
            LastName = "Name",
            IsActive = true
        };

        // Act
        var validationResults = ValidateModel(dto);

        // Assert
        Assert.Empty(validationResults);
    }

    [Fact]
    public void UpdateUserDto_WithAllNullFields_PassesValidation()
    {
        // Arrange
        var dto = new UpdateUserDto
        {
            FirstName = null,
            LastName = null,
            IsActive = null
        };

        // Act
        var validationResults = ValidateModel(dto);

        // Assert
        Assert.Empty(validationResults);
    }

    [Fact]
    public void UpdateUserDto_WithOnlyFirstName_PassesValidation()
    {
        // Arrange
        var dto = new UpdateUserDto
        {
            FirstName = "NewFirstName",
            LastName = null,
            IsActive = null
        };

        // Act
        var validationResults = ValidateModel(dto);

        // Assert
        Assert.Empty(validationResults);
    }

    [Fact]
    public void UpdateUserDto_WithRoleChange_PassesValidation()
    {
        // Arrange
        var dto = new UpdateUserDto
        {
            FirstName = "Updated",
            LastName = "Name",
            Role = "Admin",
            IsActive = true
        };
